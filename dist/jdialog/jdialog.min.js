!function(a){function b(){return"dlgc-"+(++h).toString()}function d(){return f?f:f=new p}function q(){var b=a.__jdialog;"object"==typeof b&&(settings=e.extend({},settings,b)),settings.register&&d().register()}var e,f,i,j,k,l,m,n,o,p,g=1e4,h=0;loadedThemes={},activeDialogs=[],settings={register:!1,theme:"default"},document=a.document,dialogTemplate='<div class="dialog-main dialog-theme-{theme}" tabindex="1" id="{id}" style="display:none;"><div class="dialog-title"><div class="dialog-title-label"><span class="dialog-title-text"></span></div><div class="dialog-title-buttons"><div class="dialog-button dialog-button-close" id="{id}-close"><button>&times;</button></div></div></div><div class="dialog-client"><div class="dialog-message"><pre class="dialog-message-text"></pre></div><div class="dialog-body"></div></div><div class="dialog-footer"><div class="dialog-footer-buttons"></div></div></div>',i={textbox:function(){var d,a=this.config,b=this.id,c=this.parent;a.label&&c.append(e("<label></label>").addClass("dialog-label").attr("for",b).text(a.label)),a.multiline?(d=e("<textarea></textarea>").attr("id",b),a.rows&&d.attr("rows",a.rows)):d=e("<input>").attr("id",b).attr("type",a.password?"password":"text"),a.placeholder&&d.attr("placeholder",a.placeholder),a.value&&d.val(a.value),a.maxlength&&d.attr("maxlength",a.maxlength),a.width&&d.width(a.width),c.append(e('<div class="dialog-textbox"></div>').append(d))},checkbox:function(){var a=this.config,b=this.id,c=this.parent,d=e("<input>").attr("id",b).attr("type","checkbox");a.checked&&d.attr("checked","checked"),c.append(e('<div class="dialog-checkbox"></div>').append(d)),a.label&&c.append(e("<label></label>").addClass("dialog-label").attr("for",b).text(a.label)),this.data=function(){return input[0].checked}}},j=function(){var a,c,d,g,e,f;if(document.currentScript)return document.currentScript.src;try{({}).b()}catch(b){a=b.fileName||b.sourceURL||b.stack||b.stacktrace}if(a&&(c=/((?:http|https|file):\/\/.*?\/[^:]+)(?::\d+)?:\d+/.exec(a)[1]))return c;for(d=-1===(""+document.querySelector).indexOf("[native code]"),e=document.scripts,f=e.length-1;g=e[f--];)if("interactive"===g.readyState)return d?g.getAttribute("src",4):g.src}(),k=j.substring(0,j.lastIndexOf("/")),l={ok:{text:"确定",primary:!0,"default":!0}},m={ok:{text:"确定",primary:!0,"default":!0},cancel:{text:"取消",cancel:!0}},n={yes:{text:"是",primary:!0},no:{text:"否",primary:!0}},o={yes:{text:"是",primary:!0},no:{text:"否",primary:!0},cancel:{text:"取消",cancel:!0}},p=function(c){this.theme=c?c:settings.theme,this.init=function(){function g(b,c){switch(b){case"object":e.each(c,function(b,c){a[b]=c});break;case"string":this.message=c;break;default:this.message=""+c}}var c,d,f,a=this,b=arguments.length;switch(b){case 2:e.isFunction(d=arguments[1])&&(this.onclose=d),g(e.type(c=arguments[0]),c);break;case 1:f=e.type(c=arguments[0]),"function"==f?this.onclose=param:g(f,c);break;case 0:this.title=this.message="",this.width=this.height=0,this.position="center",this.modal=this.closable=this.draggable=this.animation=!0,this.body={},this.components={},this.buttons=e.extend({},l)}},this.init(),this.isShown=function(){return Boolean(this.dialogElement)},this.setPosition=function(){var a,b,c;switch(this.width>0&&this.dialogElement.width(this.width),this.height>0&&this.dialogElement.find(".dialog-client").height(this.height),a=this.position.split(" ",2),1==a.length&&(a[1]="center"),b=a[0].toLowerCase(),c=a[1].toLowerCase(),b){case"left":this.dialogElement.css("left","0");break;case"center":this.dialogElement.css({left:"50%","margin-left":"-"+(this.dialogElement.outerWidth()/2).toString()+"px"});break;case"right":this.dialogElement.css({left:"100%","margin-left":"-"+this.dialogElement.outerWidth().toString()+"px"});break;default:this.dialogElement.css("left",b)}switch(c){case"top":this.dialogElement.css("top","0");break;case"center":this.dialogElement.css({top:"50%","margin-top":"-"+(this.dialogElement.outerHeight()/2).toString()+"px"});break;case"bottom":this.dialogElement.css({top:"100%","margin-top":"-"+this.dialogElement.outerHeight().toString()+"px"});break;default:this.dialogElement.css("top",b)}},this.render=function(){function d(b){return function(){if(e.isFunction(a.onclose)){var c=a.onclose.call(a,b);(c||"undefined"==typeof c)&&a.close()}else a.close()}}var f,g,h,j,l,m,k,a=this,c=this.dialogElement;if(this.title&&c.find(".dialog-title-text").text(this.title),this.message?(c.find(".dialog-message-text").text(this.message),c.find(".dialog-message").css("display","block")):c.find(".dialog-message").css("display","none"),f=c.find(".dialog-button-close>button"),f.unbind("click"),this.closable?(c.removeClass("dialog-style-unclosable").addClass("dialog-style-closable"),f.click(d("close"))):(c.removeClass("dialog-style-closable").addClass("dialog-style-unclosable"),f.attr("disabled","disabled")),g=c.find(".dialog-body"),e.isEmptyObject(this.body))g.css("display","none");else switch(g.empty().css("display","block"),e.type(this.body)){case"string":g.html(this.body);break;case"array":e.each(this.body,function(c,d){var f,h,j;i[d.type]&&(f=i[d.type],h=e('<div class="dialog-layout"></div>'),j={config:d,id:b(),parent:h},f.call(j),d.name&&(a.components[d.name]=j),h.appendTo(g))});break;default:g.empty().append(this.body)}h=c.find(".dialog-footer-buttons"),h.empty(),e.each(this.buttons,function(c,f){var k,g="",i=f.default,j=f.cancel;g+='<div class="dialog-button',f.primary&&(g+=" dialog-button-primary"),i?g+=" dialog-button-default":j&&(g+=" dialog-button-cancel"),f.class&&(g+=f.class),g+='" name="'+c+'" id="'+b()+'"><button></button></div>',k=e(g),k.children("button").text(f.text).click(d(c)),h.append(k),i?a.defaultButton=k:j&&(a.cancelButton=k)}),j=c.find(".dialog-title"),this.draggable?(k=!1,j.mousedown(function(b){l=b.pageX-parseInt(a.dialogElement.css("left")),m=b.pageY-parseInt(a.dialogElement.css("top")),k=!0}).mouseup(function(){k=!1}).mousemove(function(b){k&&a.dialogElement.css({left:b.pageX-l,top:b.pageY-m})}),c.addClass("dialog-style-draggable").removeClass("dialog-style-undraggable")):(j.unbind("mousedown mouseup mousemove"),c.addClass("dialog-style-undraggable").removeClass("dialog-style-draggable")),this.modal?(c.addClass("dialog-style-modal").removeClass("dialog-style-modeless"),this.maskElement.css("display","block")):(c.addClass("dialog-style-modeless").removeClass("dialog-style-modal"),this.maskElement.css("display","none"))},this.show=function(){var a,c,d;return this.isShown()?this:(this.init.apply(this,arguments),a=this,c=this.dialogElement=e(dialogTemplate.replace(/\{theme\}/,this.theme).replace(/\{id\}/,this.id=b())),d=this.maskElement=e('<div class="dialog-mask" style="position:fixed;width:100%;height:100%;left:0;top:0;"></div>'),d.css("z-index",g++),c.css("z-index",g++),this.render(),c.keydown(function(b){switch(b.keyCode){case 27:a.cancelButton&&a.cancelButton.children("button").trigger("click");break;case 13:a.defaultButton&&"textarea"!=b.target.tagName.toLowerCase()&&a.defaultButton.children("button").trigger("click")}}),e(document.body).append(d).append(c),this.setPosition(),this.animation?c.show("fast"):c.css("display","block"),activeDialogs.push(this),c.focus(),this)},this.close=function(){function b(){a.dialogElement.remove(),delete a.dialogElement,a.maskElement.remove(),delete a.maskElement;for(var b in activeDialogs)if(activeDialogs[b]==a){activeDialogs.splice(b,1);break}activeDialogs.length>0&&activeDialogs[activeDialogs.length-1].dialogElement.focus(),a.init()}if(this.isShown()){var a=this;return this.animation?this.dialogElement.hide("fast",b):b(),this}},this.update=function(){return this.dialogElement,this.init.apply(this,arguments),this.render(),this.setPosition(),this},this.register=function(){return this._originalAlertHandler=a.alert,this._originalConfirmHandler=a.confirm,this._originalPromptHandler=a.prompt,this._originalOpenHandler=a.open,a.alert=function(a,b){d().show({title:"提示",message:a,buttons:l},function(){return e.isFunction(b)?b("ok"):void 0})},a.confirm=function(a,b){d().show({title:"确认",message:a,buttons:m},function(a){return e.isFunction(b)?b("ok"==a?!0:!1):void 0})},a.prompt=function(a,b,c){d().show({message:a,body:[{type:"textbox",value:b,name:"value"}],buttons:m},function(){return e.isFunction(c)?c(this.getData("value")):void 0})},this},this.restore=function(){return this._originalAlertHandler&&(a.alert=this._originalAlertHandler),this._originalConfirmHandler&&(a.confirm=this._originalConfirmHandler),this._originalPromptHandler&&(a.prompt=this._originalPromptHandler),this._originalOpenHandler&&(a.open=this._originalOpenHandler),this},this.getData=function(a){var b=this.components[a];return b?b.data?this.components[a].data():e("#"+b.id).val():void 0},this.loadTheme=function(){if(!(e.inArray(this.theme,loadedThemes)>=0)){var a=k+"/themes/"+this.theme;e("<link>").attr({rel:"stylesheet",type:"text/css",href:a+"/theme.css"}).appendTo("head"),loadedThemes[this.theme]=a}},this.loadTheme()},p.BUTTON_OK=l,p.BUTTON_OK_CANCEL=m,p.BUTTON_YES_NO=n,p.BUTTON_YES_NO_CANCEL=o,p.default=d,p.registerComponent=function(a,b){i[a]=b},p.unregisterComponent=function(a){delete i[a]},"undefined"!=typeof define&&define.amd?define("jdialog",["jquery"],function(a){return e=a,q(),p}):(a.jDialog=p,e=a.$?a.$:a.jQuery,q())}(window);
